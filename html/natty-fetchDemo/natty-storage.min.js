/*! natty-storage.min.js v2.2.0 | MIT License | fushan | https://github.com/jias/natty-storage */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.nattyStorage=e()}(this,function(){"use strict";function t(t){return t=window[t],{set:function(e,r){t.setItem(e,JSON.stringify(r))},get:function(e){var r=t.getItem(e);if(!r)return m;try{r=JSON.parse(r)}catch(t){c&&console.log(t)}return r},remove:function(e){t.removeItem(e)}}}function e(){var t=x;return{set:function(e,r){t[e]=r},get:function(e){return e in t?t[e]:m},remove:function(e){delete t[e]}}}function r(t){return t.split(A).reverse().join(A)}function n(t){var e;if(t.indexOf("\\.")===-1)e=t.split(".");else{e=r(t).split(/\.(?!\\)/).reverse();for(var n=0,i=e.length;n<i;n++)e[n]=r(e[n].replace(/\.\\/g,"."))}return e}function i(t,e,r){for(var i=n(t),a=r;i.length;){var o=i.shift();if(i.length)a[o]=a[o]||{},a=a[o];else{if(!p(a)){var s=t.replace(new RegExp("\\."+o+"$"),"");throw new Error("Cannot create property '"+o+"' on '"+s+"'(non-plain-object) node: "+(D(a)?a.get():a))}a[o]=e}}return r}function a(t,e,r){if((r=r||!1)===!0||t.indexOf(".")===-1)return D(e[t])?e[t].get():e[t];for(var i=n(t);i.length;){if("object"!=typeof(e=a(i.shift(),e,!0))||e===C){i.length&&(e=C);break}}return e}function o(t,e,r){if(r=r||t.indexOf(".")===-1)return e.hasOwnProperty(t);for(var i=n(t);i.length;){var o=i.shift(),s=e.hasOwnProperty(o);if(!s||!i.length)return s;if(e=a(o,e,!0),!p(e))return S}}function s(t,e){for(var r=n(t),i=e;r.length;){var a=r.shift();r.length?(i[a]=i[a]||{},i=i[a]):delete i[a]}return e}var h="undefined"!=typeof window,c="undefined"!=typeof console,u=Object.prototype.toString,f=function(t){return"object"==typeof t&&null!==t},_=function(t){return null!==t&&t===t.window},p=function(t){return null!==t&&f(t)&&!_(t)&&Object.getPrototypeOf(t)===Object.prototype},d=function(t){return"[object Array]"===u.call(t)},l=function(t,e){void 0===t&&(t={}),void 0===e&&(e={});for(var r in e)e.hasOwnProperty(r)&&e[r]!==undefined&&(d(e[r])?t[r]=[].concat(e[r]):p(e[r])?t[r]=l({},e[r]):t[r]=e[r]);return t},g=function(t){return function(){for(var e=arguments,r=t(e[0],e[1]),n=2,i=e.length;n<i;n++)r=t(r,e[n]);return r}}(l),y=function(){},v="ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678",w=function(t){void 0===t&&(t=32);for(var e="",r=0;r<t;r+=1)e+=v.charAt(Math.floor(Math.random()*v.length));return e},b=function(){},k=function(t,e){var r=w(6),n="_"+r,i="_"+r+":env";return new(function(r){function a(){r.call(this),this[n]=e,this[i]=t}return r&&(a.__proto__=r),a.prototype=Object.create(r&&r.prototype),a.prototype.constructor=a,a.prototype.get=function(){return this[n][t]!==undefined?this[n][t]:undefined},a}(b))},D=function(t){return t instanceof b},E=function(t,e){return k(t,e)},m=null,A="",O=!0,S=!O,C=undefined,K=function(){if(!h)return S;if("object"!=typeof localStorage)return S;var t=O;try{var e="__nstest__";localStorage.setItem(e,e),t=localStorage.getItem(e)===e,localStorage.removeItem(e)}catch(e){t=S}return t}(),Y={type:"variable",key:A,tag:A,duration:0,until:0},I=function(r){if(void 0===r&&(r={}),this.config=g({},Y,r),!this.config.key)throw new Error("`key` is required when creating a storage!");this._storage="variable"!==this.config.type&&K?t(this.config.type):e(),this._CHECK_KEY="NSCheck:"+this.config.key,this._DATA_KEY="NSData:"+this.config.key,this._createStamp=+new Date,this._backupData={},this._checkData=this._storage.get(this._CHECK_KEY),this._isNew=this._checkData===m,this._fastCache={}};I.prototype._lazyInit=function(){this._isNew||this.isOutdated()?this._storage.set(this._DATA_KEY,this._data={}):(this._data=this._storage.get(this._DATA_KEY),this._data===m&&this._storage.set(this._DATA_KEY,this._data={})),this._storage.set(this._CHECK_KEY,this._checkData={key:this.config.key,tag:this.config.tag,lastUpdate:this._createStamp,duration:this.config.duration,until:this.config.until})},I.prototype.isOutdated=function(){if(this.config.tag&&this.config.tag!==this._checkData.tag)return O;var t=+new Date;return this._checkData.duration&&t-this._checkData.lastUpdate>this._checkData.duration?O:this._checkData.until&&t>this._checkData.until?O:S},I.prototype.data=function(t){if(this._data||this._lazyInit(),!p(t))throw new Error("The argument for data() must be a plain object. Invalid: "+t);this._fastCache={},this._backupData=this._data;try{this._data=t,this._storage.set(this._DATA_KEY,this._data)}catch(t){throw this._storage.set(this._DATA_KEY,this._data=this._backupData),new Error(t)}},I.prototype.set=function(t,e){if(this._data||this._lazyInit(),"variable"!==this.config.type&&D(e))throw new Error("'env' value can NOT be used for 'type: "+this.config.type+"'");if("string"!=typeof t)throw new Error("The first argument for set() must be a string. Invalid: "+t);delete this._fastCache[t],this._backupData=this._data;try{i(t,e,this._data),this._storage.set(this._DATA_KEY,this._data)}catch(t){throw this._storage.set(this._DATA_KEY,this._data=this._backupData),new Error(t)}},I.prototype.get=function(t,e){if(this._data||this._lazyInit(),this._fastCache.hasOwnProperty(t))return this._fastCache[t];var r;try{r=t?a(t,this._data):this._data}catch(t){throw new Error(t)}return r=r!==C?r:e,this._fastCache[t]=r,r},I.prototype.sure=function(t){var e=this.get(t);if(e===C)throw new Error("Unexpected undefined value returned by path '"+t+"'");return e},I.prototype.has=function(t){if(this._data||this._lazyInit(),!t)throw new Error("a `key|path` argument should be passed into the `has` method");return o(t,this._data)?{has:O,value:a(t,this._data)}:{has:S,value:C}},I.prototype.remove=function(t){this._data||this._lazyInit(),this._backupData=this._data,t?s(t,this._data):this._data={};try{this._storage.set(this._DATA_KEY,this._data)}catch(t){throw this._storage.set(this._DATA_KEY,this._data=this._backupData),new Error(t)}},I.prototype.destroy=function(){var t=this;this._data=m,this._checkData=m,this._fastCache=m,this._storage.remove(this._DATA_KEY),this._storage.remove(this._CHECK_KEY);for(var e in t.constructor.prototype)t.constructor.prototype.hasOwnProperty(e)&&(t[e]=C)},I.prototype.dump=function(){this._data||this._lazyInit(),JSON&&c&&console.log(JSON.stringify(this._data,m,4))};for(var T=["set","get","has","remove","destroy"],j=0,N=T.length;j<N;j++)!function(t,e){var r=T[t];I.prototype["async"+r.charAt(0).toUpperCase()+r.substr(1)]=function(){var t=arguments,e=this;return new Promise(function(n,i){try{n(e[r].apply(e,t))}catch(t){i(t)}})}}(j);var x={},P=function(t){return new I(t)};return P.version="2.2.0",P._variable=x,P.supportStorage=K,P.each=function(t){void 0===t&&(t=y);var e={variable:P._variable};K&&(e.localStorage=localStorage,e.sessionStorage=sessionStorage);for(var r in e)for(var n in e[r])if(e[r].hasOwnProperty(n)&&n.indexOf("NSCheck:")>-1){var i=P({key:n.match(/NSCheck:(.*)/)[1],type:r});t(i)}},P.clean=function(){this.each(function(t){t.isOutdated()&&t.destroy()})},P.list=function(){this.each(function(t){c&&console.log(t.config.type,t.config.key,t.get())})},P.clean(),P.env=E,P});
//# sourceMappingURL=natty-storage.min.js.map
